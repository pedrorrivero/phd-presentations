%%    _____  _____
%%   |  __ \|  __ \    AUTHOR: Pedro Rivero
%%   | |__) | |__) |   ---------------------------------
%%   |  ___/|  _  /    DATE: April 26, 2020
%%   | |    | | \ \    ---------------------------------
%%   |_|    |_|  \_\   https://github.com/pedrorrivero
%%

\ProvidesPackage{beamerthemePedroRiveroANLwide}[2019/10/15]

%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Packages and Functions
%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\RequirePackage{amsmath}
\RequirePackage{mathtools}
	\DeclarePairedDelimiter\bra{\langle}{\rvert}
	\DeclarePairedDelimiter\ket{\lvert}{\rangle}
	\DeclarePairedDelimiterX\braket[2]{\langle}{\rangle}{#1 \delimsize\vert #2}
	\DeclarePairedDelimiterX\braketop[3]{\langle}{\rangle}{#1 \delimsize\vert #2 \delimsize\vert #3}

\newcommand{\SectionTitle}[1]{ { \textbf{ \begin{center} \Huge \color{DetailColor} \underline{#1} \end{center} }} }

%\AtBeginSection[]
%{
%  \begin{frame}
%    \frametitle{Table of Contents}
%    \tableofcontents[currentsection]
%  \end{frame}
%}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Packages
%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\RequirePackage{media9,tagging}
\RequirePackage{pgfplots}
\RequirePackage{amsmath}
\RequirePackage{mathtools}
\pgfplotsset{compat=1.10}
\usetikzlibrary{calc}
\RequirePackage[utf8]{inputenc}
\RequirePackage[T1]{fontenc}

%% Justify text
\RequirePackage{ragged2e}
\RequirePackage{etoolbox}
\apptocmd{\frame}{}{\justifying}{}

%% Use any fonts you like.
\RequirePackage{helvet,multicol}
\newcommand\Newline{\newline\newline}

%% Physics
\RequirePackage{physics}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Color Definition
%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%\definecolor{UMMaize}{RGB}{235,185,50}
%\definecolor{UMBlue}{RGB}{40,55,85}
%\definecolor{IITred}{RGB}{205,39,19}
%\definecolor{DarkGrey}{RGB}{50,50,50}
%\definecolor{LightBlue}{RGB}{0,118,235}
%\definecolor{Purple}{RGB}{108,0,215}
%\definecolor{Orange}{RGB}{255,128,0}
%\definecolor{Green}{RGB}{0,164,0}
%\definecolor{Gold}{RGB}{235,185,50}
%\definecolor{UPMblue}{RGB}{0,60,179}
%\definecolor{Pegasusblue}{RGB}{0,102,153}
%\definecolor{Pegasuslightblue}{RGB}{0,136,204}

\definecolor{DetailColor}{RGB}{0,118,235}
\definecolor{BackgroundColor}{RGB}{50,50,50}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Outer theme
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\useoutertheme[width=.12\paperwidth]{sidebar}
\setlength{\beamer@headheight}{.185\paperheight}
\pgfdeclareimage[width=.08\paperwidth]{main-logo}{LOGOS/Main_Logo}
\pgfdeclareimage[height=.08\paperwidth]{negative-logo}{LOGOS/Main_Logo_Negative}
\pgfdeclareimage[width=.48\paperwidth]{closure-logo}{LOGOS/Closure}
\pgfdeclareimage[height=.5\paperheight]{large-corner}{LOGOS/Large_Corner}
\pgfdeclareimage[height=\beamer@headheight]{small-corner}{LOGOS/Small_Corner}
\setbeamertemplate{sidebar left}{%
\vskip5pt
\hskip2pt
\insertverticalnavigation{\beamer@sidebarwidth}%
}

\setbeamertemplate{footline}[text line]{%
\insertshortauthor\strut\hfill
\insertshorttitle\hfill
%\insertshortdate\hspace{1em}
\insertframenumber/\inserttotalframenumber}
\setbeamerfont{footline}{size=\fontsize{6}{12}\selectfont}
%\setbeamerfont{footline}{size=\fontsize{9}{10}\selectfont}

\addtobeamertemplate{notitle}{}{%
\begin{pgfpicture}
\pgftext[at=\pgfpoint{\paperwidth}{-\beamer@headheight},right,base]{\pgfuseimage{small-corner}}
\pgfsetcolor{white}
\pgfusepath{stroke}
\pgfsetcolor{DetailColor}
\pgfusepath{stroke}
\pgftext[at=\pgfpoint{.073\paperwidth}{-.97\paperheight},center,base]{\pgfuseimage{main-logo}}
\end{tikzpicture}}

\addtobeamertemplate{frametitle}{}{%
\begin{pgfpicture}
\pgf@relevantforpicturesizefalse
\pgftransformxshift{-\Gm@lmargin}
\pgftransformyshift{\beamer@headheight+15pt}
\pgftext[at=\pgfpoint{\paperwidth}{-\beamer@headheight},right,base]{\pgfuseimage{small-corner}}
\pgfpathmoveto{\pgfpoint{.12\paperwidth}{0pt}}
\pgfpathlineto{\pgfpoint{.12\paperwidth}{-\beamer@headheight}}
\pgfsetlinewidth{3.5pt}
\pgfsetinnerlinewidth{1pt}
\pgfsetinnerstrokecolor{DetailColor}
\pgfsetcolor{white}
\pgfusepath{stroke}
\pgfpathmoveto{\pgfpoint{.12\paperwidth}{-.22\paperheight}}
\pgfpathlineto{\pgfpoint{.12\paperwidth}{-.97\paperheight}}
\pgfsetlinewidth{1pt}
\pgfsetinnerlinewidth{0pt}
\pgfsetcolor{DetailColor}
\pgfusepath{stroke}
\pgftext[at=\pgfpoint{.06\paperwidth}{-.97\paperheight},center,base]{\pgfuseimage{main-logo}}
\end{pgfpicture}%
\vskip-18pt%
}

\addtobeamertemplate{title page}{%
\usebeamertemplate{title background}%
\vskip .2\paperheight%
}
{}

\newcommand\DoColorBackground{
\pgfpathmoveto{\pgfpointorigin}
\pgfpathrectanglecorners{\pgfpoint{0pt}{0pt}}{\pgfpoint{\paperwidth}{-\paperheight-5pt}}
\pgfsetfillcolor{BackgroundColor}
\pgfusepath{fill}
\pgftext[at=\pgfpoint{\paperwidth}{-\paperheight-4.4pt},right,base]{\pgfuseimage{large-corner}}
}

\setbeamertemplate{title background}{%
\vspace*{-4.5\baselineskip}
\begin{pgfpicture}
\pgf@relevantforpicturesizefalse
\pgftransformxshift{-\Gm@lmargin}
\pgftransformyshift{5.5pt}
\DoColorBackground

% White bar across top
\pgfpathmoveto{\pgfpointorigin}
\pgfpathrectanglecorners{\pgfpoint{0pt}{0pt}}{\pgfpoint{\paperwidth}{-.25\paperheight}}
\pgfsetfillcolor{white}
\pgfusepath{fill}

% DetailColor short bar up on left
\pgfpathrectanglecorners{\pgfpoint{0pt}{0pt}}{\pgfpoint{.12\paperwidth}{-.183\paperheight}}
\pgfsetfillcolor{DetailColor}
\pgfusepath{fill}

% Logo
\pgftext[at=\pgfpoint{.015\paperwidth}{-.17\paperheight},left,base]{\pgfuseimage{negative-logo}}

% BackgroundColor short bar on left
\pgfpathrectanglecorners{\pgfpoint{0pt}{-.19\paperheight}}{\pgfpoint{.12\paperwidth}{-.24\paperheight}}
\pgfsetfillcolor{BackgroundColor}
\pgfusepath{fill}

% Followed by DetailColor bar on right
\pgfpathrectanglecorners{\pgfpoint{.12\paperwidth}{-.19\paperheight}}{\pgfpoint{\paperwidth}{-.24\paperheight}}
\pgfsetfillcolor{DetailColor}
\pgfusepath{fill}

% A stroke down the middle
\pgfpathmoveto{\pgfpoint{.12\paperwidth}{-.19\paperheight}}
\pgfpathlineto{\pgfpoint{.12\paperwidth}{-.24\paperheight}}
\pgfsetlinewidth{3.5pt}
\pgfsetinnerlinewidth{1pt}
\pgfsetinnerstrokecolor{DetailColor}
\pgfsetrectcap
\pgfsetcolor{white}
\pgfusepath{stroke}

\pgfpathmoveto{\pgfpoint{.12\paperwidth}{-.28\paperheight}}
\pgfpathlineto{\pgfpoint{.12\paperwidth}{-.48\paperheight}}
\pgfsetlinewidth{1pt}
\pgfsetinnerlinewidth{0pt}
\pgfsetcolor{DetailColor}
\pgfusepath{stroke}

\pgfpathmoveto{\pgfpoint{.12\paperwidth}{-.54\paperheight}}
\pgfpathlineto{\pgfpoint{.12\paperwidth}{-.62\paperheight}}
\pgfsetlinewidth{1pt}
\pgfsetcolor{white}
\pgfusepath{stroke}

\pgfpathmoveto{\pgfpoint{.12\paperwidth}{-.9\paperheight}}
\pgfpathlineto{\pgfpoint{.12\paperwidth}{-.93\paperheight}}
\pgfsetlinewidth{1pt}
\pgfsetcolor{white}
\pgfusepath{stroke}

\pgftext[at=\pgfpoint{.13\paperwidth}{-.92\paperheight},left,base]{\tiny \href{http://\website}{\website}}
\end{pgfpicture}%
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Inner Theme
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\useinnertheme{rectangles}
\setbeamertemplate{navigation symbols}{}

\setlength{\leftmargini}{.5em}
\setlength{\leftmarginii}{1.0em}
\setlength{\leftmarginiii}{1.5em}
\setlength{\leftmarginiv}{2.0em}
\setlength{\leftmarginv}{2.5em}
\setlength{\leftmarginvi}{3.0em}
%\setlength{\footnotesep}{1pt} % Check how to reduce the spacing between text and footer

%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Colours
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usecolortheme[named=DetailColor]{structure}
\usecolortheme{rose}
\setbeamercolor{title page}{fg=white}
\setbeamerfont{title}{size=\fontsize{14pt}{16}\selectfont}
\setbeamerfont{subtitle}{size=\fontsize{10pt}{12}\selectfont}
\setbeamerfont{frametitle}{size=\fontsize{13pt}{15}\selectfont}
\setbeamercolor{logo}{bg=DetailColor}
\setbeamercolor{frametitle}{fg=DetailColor!40!white,bg=BackgroundColor}
%\setbeamercolor{frametitle}{fg=DetailColor,bg=BackgroundColor}
%\setbeamercolor{frametitle}{fg=white,bg=BackgroundColor}
\setbeamercolor{section in sidebar}{fg=DetailColor}
\setbeamerfont{section in sidebar}{series=\bfseries}
\setbeamercolor{subsection in sidebar}{fg=black}
\setbeamercolor{block title}{bg=BackgroundColor!28!white,fg=BackgroundColor}
\setbeamercolor{block body}{bg=DetailColor!15!white}
\setbeamercolor{title}{fg=DetailColor!40!white}

\newcommand\FinalFrame{
\begin{frame}[plain,t]
\vspace*{-4.5\baselineskip}
\begin{pgfpicture}
\pgf@relevantforpicturesizefalse
\pgftransformxshift{-\Gm@lmargin}
\pgftransformyshift{5.5pt}
\DoColorBackground
\pgftext[at=\pgfpoint{.5\paperwidth}{-.45\paperheight},center,center]{\pgfuseimage{closure-logo}}
\pgftext[at=\pgfpoint{.5\paperwidth}{-.3\paperheight},center,center]{\huge\structure{\textcolor{DetailColor!40!white}{}}} %Include Text like: "Thank You!"

\end{pgfpicture}
\end{frame}
}

%\usepackage{etoolbox}
\makeatletter
\patchcmd{\endbeamer@frameslide}{\ifx\beamer@frametitle\@empty}{\iffalse}{}{\errmessage{failed to patch}}
\makeatother
